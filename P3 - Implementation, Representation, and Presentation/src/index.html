<!DOCTYPE html>
<head>
	<meta charset="UTF-8">
	<script src="https://d3js.org/d3.v6.min.js"></script>
	<title>CPSC 583 - P3 Implementation, Representation, and Presentation</title>
	
<style>
	.slidercontainer{
		width: 80%;
		margin: auto;
		padding: 20px;
	}
	.slider{
		-webkit-appearance: none;
		appearance: none;
		width: 100%;
		height: 5px;
		background: rgb(100,100,100);
	}
	.slider::-webkit-slider-thumb{
		-webkit-appearance: none;
		appearance: none;
		width: 25px;
		height: 25px;
		background: rgb(200,200,200);
		border-radius: 15px;
	}
</style>
</head>

<body style="background-color: rgb(36,36,36)">
	<div style="text-align: center; font-family: Verdana; font-size: 36px; color: yellow; padding: 20px">Host Cities of Tour de France</div>
	
	<svg style="display: block; margin: auto" width=700 height=700>
		<g id="circle"></g>
		<g id="labels"></g>
	</svg>
	
	<div id="yearDisplay" style="text-align: center; font-family: Verdana; font-size: 36px; color: yellow"></div>
	
	<div class="slidercontainer">
		<input id="year" class="slider" type="range" min="1903" max="2017" value="2017">
	</div>

	
</body>

<script>
	
	
	
	// Year slider functionality
	var slider = document.getElementById("year");
	var yearDisplay = document.getElementById("yearDisplay");
	yearDisplay.innerHTML = slider.value;
	
	slider.oninput = function(){
		yearDisplay.innerHTML = this.value;
	}
	
	
	
	// D3 to draw spokes
	var data = d3.csv("stages_TDF.csv").then(showData);
	
	
	// Checks array objects if it contains a city
	function containsCity(cities, newCity){
		for(var i = 0; i < cities.length; i++){
			if(cities[i].name == newCity){
				return true;
			}
		}
		return false;
	}
	
	// Print stage data
	function showData(stages){
		var uniqueCities = new Array();
		var currentYearStages = new Array();
		
		for(var stage of stages){
			if(stage.Date < "2018" && stage.Date > "2017"){				// TODO magic numbers here
				if(!containsCity(uniqueCities, stage.Origin)){
					uniqueCities.push({"name":stage.Origin});
				}
				if(!containsCity(uniqueCities, stage.Destination)){
					uniqueCities.push({"name":stage.Destination});
				}
			currentYearStages.push(stage);
			}
		}
		
		console.log(uniqueCities);
		
		var scaleX = d3.scaleBand()
						.domain(uniqueCities.map(city => city.name))
						.range([0, 360])
		
		
		var circleX = 350;
		var circleY = circleX;
		var radius = 200;
		
		
		
		// Draw circle
		var circle = d3.select("#circle")
						.append("circle")
						.attr("cx", circleX)
						.attr("cy", circleY)
						.attr("r", radius)
						.style("fill", "none")
						.style("stroke", "gray")
						.style("stroke-width", 5);
		
		// Draw labels
		var labels = d3.select("#labels")
						.selectAll("text")
						.data(uniqueCities).enter()
						.append("text")
						.attr("x", circleX)
						.attr("y", circleY)
						.text(function(d) {return d.name})
						.attr("fill", "yellow")
						.attr("font-family", "Verdana")
						.attr("text-anchor", "start")
						.attr("dominant-baseline", "central")
						.attr("transform", function(d) {return "rotate(" + scaleX(d.name) + ", " + circleX + " ," + circleY + ") translate(" + (radius + 10) + ", 0)"});
		
		
		
		
		
		
		
		
		/*
		var x = d3.scaleBand()
			.range([0, 360])
			.align(0)
			.domain(stages.map(d => d))
		
		var svg = d3.select("svg");
		
		svg.selectAll("text.label")
			.data(selectedYearCities).enter()
			.append("text")
			.attr("class", "label")
			.attr("x", "200")
			.attr("y", "200")
			.attr("fill", "yellow")
			.text(function(d) {return d})
			.attr("text-anchor", "middle")
			.attr("transform", "rotate(" + x(d) + ")");
			*/
		
	}
</script>